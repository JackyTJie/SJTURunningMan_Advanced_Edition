# SJTU 一键校园跑工具说明

欢迎使用 SJTU 一键校园跑工具！

## 简介

本工具旨在帮助 SJTU 学生模拟体育跑步数据并上传，以满足学校的体育锻炼要求。请确保您在使用本工具时遵守学校的相关规定。

本工具支持自定义跑步天数、时间和距离，帮助用户灵活完成体育锻炼要求。默认配置会生成从上一日开始的连续指定天数的跑步记录（默认为1天），每次跑步5km，时间为8:00。程序优先使用user.txt作为路线文件，若不存在则使用default.txt作为默认路线文件。

## 功能特性

### 1. 图形用户界面 (GUI)

**用户配置区域:**
- **用户名输入框**: 输入您的Jaccount用户名
- **密码输入框**: 输入您的Jaccount密码（密码输入为星号隐藏显示）

**上传设置区域:**
- **上传天数选择**: 从预设选项（1, 5, 10, 15, 20, 25天）中选择或选择"自定义"输入自定义天数
- **跑步时间选择**: 从6:00-23:00的小时选项中选择跑步发生时间（默认8:00）
- **跑步距离选择**: 从1-5公里范围内选择每次跑步的距离（默认5公里）

**功能按钮:**
- **一键跑步按钮**: 执行完整的跑步数据生成和上传流程
- **停止按钮**: 在上传过程中停止当前任务
- **生成路线按钮**: 打开浏览器路线规划器进行自定义路线绘制
- **关于按钮**: 显示工具信息和使用说明

**实时反馈区域:**
- **进度条**: 显示上传进度（已完成/总任务数）
- **状态标签**: 显示当前操作状态
- **日志输出区域**: 显示详细的操作日志信息（成功、失败、警告等不同颜色标识）

### 2. 命令行界面 (CLI)

**基本用法:**
```bash
python cliui.py -u <username> -p <password> -d 5.0
```

**主要参数选项:**
- `--username, -u`: 学号/用户名
- `--password, -p`: 密码
- `--distance, -d`: 跑步距离 (km)，默认5.0km
- `--hour, -H`: 跑步时间 (小时)，默认8点
- `--times, -t`: 上传天数，默认1天
- `--pace, -P`: 配速 (分钟/公里)，默认3.5 min/km

**路线选择选项:**
- `--route, -r`: 选择路线文件 (default/user)，默认default
- `--route-file`: 指定自定义路线文件路径
- `--customize-route, -C`: 打开浏览器进行路线自定义规划

**高级开发选项:**
- `--speed-override, -s`: 速度覆写 (m/s)，直接指定跑步速度
- `--compensation, -c`: 补偿距离 (米)，默认200米
- `--interval, -i`: GPS点间隔 (秒)，默认3秒
- `--verify-credentials`: 验证凭据但不上传数据
- `--verbose, -v`: 启用详细输出
- `--debug-mode`: 启用调试模式
- `--dry-run`: 干运行模式（模拟运行不上传）

**API端点选项（用于开发/测试）:**
- `--host`: API主机地址，默认pe.sjtu.edu.cn
- `--uid-url`: UID API URL
- `--my-data-url`: 我的数据API URL
- `--point-rule-url`: 点规则API URL
- `--upload-url`: 上传API URL

### 3. 路线规划器

**图形化路线自定义:**
- 点击"生成路线"或使用CLI的`--customize-route`参数打开路线规划器
- 在百度地图界面中点击选择路径坐标点，形成跑步路线
- 支持添加、删除、清空坐标点
- 点击"保存路线"按钮将下载user.txt文件
- 将user.txt文件保存到项目根目录，即可使用自定义路线替代默认路线

**坐标点管理:**
- 点击地图任一点自动添加坐标点并显示在地图上
- 点击地图上的标记点可删除该坐标点
- 左侧面板显示所有选中的坐标点列表
- 支持清空所有点的功能

### 4. 数据生成与上传逻辑

**智能路径调整:**
- 根据目标距离和速度自动调整路线长度
- 如果路线长度超过目标距离，提供选择是否自动削减路线
- 如果路线较短，采用往返或环路策略以达到目标距离
- 起终点距离大于15米时使用往返策略，否则使用环路策略

**GPS坐标校正:**
- 自动应用GPS坐标偏移校正以匹配实际地图数据
- 包含额外微调校正以解决地图选择坐标与实际记录的偏差

**轨迹分段处理:**
- 将整体轨迹拆分为多个轨迹段，模拟真实的跑步过程
- 为各段分配不同的状态（正常、停止、无效）
- 包含合理的轨迹点时间戳生成

### 5. 上传流程

**三步上传流程:**
1. **获取认证信息**: 获取认证令牌和跑步规则
2. **生成跑步数据**: 根据配置生成符合要求的跑步轨迹数据
3. **上传跑步数据**: 将生成的数据上传到服务器

**多天上传支持:**
- 支持一次性上传多天的跑步数据
- 数据生成为过去N天（从昨天开始的连续N天）
- 每天对应一个独立的上传请求

**上传控制:**
- 显示每条数据的上传进度
- 记录成功和失败的上传次数
- 支持中途停止上传过程

### 6. 安全与验证

**验证码处理:**
- 自动处理实时验证码识别（通过外部模型）
- 无需用户手动输入验证码

**凭据验证:**
- 支持通过`--verify-credentials`验证凭据有效性而不上传数据
- 提供登录失败的详细错误信息

**错误处理:**
- 全面的异常处理机制
- 详细的错误日志输出
- 支持中断操作的安全处理

## 使用方法

### GUI界面使用方法

1. **启动GUI界面**:
   ```bash
   python qtui.py
   ```

2. **填写用户信息**:
   - 在"用户名"输入框中输入您的Jaccount学号
   - 在"密码"输入框中输入您的Jaccount密码

3. **设置上传参数**:
   - 从"上传天数"下拉框选择天数或选择"自定义"并输入天数
   - 从"跑步时间"下拉框选择跑步时间（6:00-23:00）
   - 从"跑步距离"下拉框选择跑步距离（1-5km）

4. **开始上传**:
   - 点击"一键跑步"按钮开始上传
   - 观察进度条和日志输出了解上传状态
   - 如需停止，点击"停止"按钮

5. **自定义路线**:
   - 点击"生成路线"按钮打开路线规划器
   - 在地图上点击选择坐标点
   - 点击"保存路线"下载user.txt文件
   - 将user.txt保存到项目根目录后重新运行程序

### CLI界面使用方法

1. **基本上传**:
   ```bash
   python cliui.py -u <学号> -p <密码> -d 5.0
   ```

2. **指定多天上传**:
   ```bash
   python cliui.py -u <学号> -p <密码> -d 5.0 -t 5
   ```

3. **自定义跑步时间**:
   ```bash
   python cliui.py -u <学号> -p <密码> -d 3.0 -H 18
   ```

4. **使用自定义路线**:
   ```bash
   python cliui.py -u <学号> -p <密码> -d 5.0 -r user
   ```

5. **高级参数设置**:
   ```bash
   python cliui.py -u <学号> -p <密码> -d 3.0 -P 4.0 -c 200 -s 3.0
   ```

6. **验证凭据**:
   ```bash
   python cliui.py -u <学号> --verify-credentials --verbose
   ```

7. **干运行模式**:
   ```bash
   python cliui.py -u <学号> -p <密码> -d 5.0 --dry-run
   ```

8. **打开路线规划器**:
   ```bash
   python cliui.py --customize-route
   ```

### 路线自定义方法

1. **使用GUI**:
   - 点击"生成路线"按钮
   - 在打开的浏览器中点击地图选择路线坐标点
   - 点击"保存路线"下载user.txt文件
   - 将user.txt文件保存到项目根目录

2. **使用CLI**:
   - 运行 `python cliui.py --customize-route`
   - 后续步骤同GUI方式

3. **手动创建路线文件**:
   - 创建名为user.txt的文件
   - 每行包含一个坐标点，格式为 "经度,纬度"
   - 例如：
     ```
     121.442938,31.031599
     121.443000,31.031600
     121.443100,31.031700
     ```

## 重要提醒

为获得最佳效果，建议：
- 尽量避免选择1公里距离的跑步(选1km大概率最后不满1km)，推荐选择2公里或以上的距离，以获得更稳定的结果
- 合理设置目标距离，不要设置过大的距离以免触发系统验证机制
- 如需精确控制跑步距离，请多次尝试以找到最适合的设置
- 自定义路线时，确保路线长度与目标距离匹配，避免过长或过短

## 免责声明

本工具仅供学习和研究目的，开发者不对因使用本工具造成的任何后果负责。请谨慎使用，并遵守所有适用的法律法规和学校规章制度。

---

**文档最后更新: Monday, November 10, 2025**